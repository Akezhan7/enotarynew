# Проект E-Notary - Интеграция WooCommerce для динамических страниц заказа

## О проекте

**E-Notary** - WordPress тема для удостоверяющего центра, специализирующегося на выпуске электронных подписей (ЭП).

Проект представляет собой перенос готовой статической HTML верстки на WordPress с интеграцией WooCommerce для создания динамической системы заказа услуг.

## Цели проекта

### Основная цель
Создать полностью функциональную систему заказа трех типов сертификатов:
- **УКЭП** (Усиленная квалифицированная электронная подпись)
- **УНЭП** (Усиленная неквалифицированная электронная подпись)  
- **МЧД** (Машиночитаемая доверенность)

### Ключевые требования
- 100% визуальная идентичность с исходной HTML версткой
- Динамическая загрузка товаров из WooCommerce
- Автоматический пересчет стоимости заказа
- Корректная работа корзины и оформления заказа
- Управление количеством товаров (где требуется)

## Выполненная работа

### 1. Структура WooCommerce
**Файлы:** `inc/product-helpers.php`, `inc/ajax-handler.php`

- ✅ Создана функция `get_product_data_by_sku()` для получения данных товаров по артикулу
- ✅ Создана функция `render_checklist_by_category()` для вывода списка товаров из категории
- ✅ Реализован AJAX обработчик `add_custom_bundle_to_cart()` для добавления набора товаров в корзину
- ✅ Настроена отложенная загрузка WooCommerce через хук `woocommerce_init`

### 2. Универсальный калькулятор
**Файл:** `assets/js/universal-calc.js`

- ✅ Разработан единый JavaScript калькулятор для всех трех страниц
- ✅ Автоматический пересчет итоговой суммы при изменении выбора
- ✅ Поддержка двух режимов:
  - С контролами количества (УКЭП)
  - Без контролов количества (УНЭП, МЧД) - quantity = 1 по умолчанию
- ✅ Автоматическое переключение чекбоксов при изменении количества
- ✅ Сбор данных и отправка в корзину через AJAX

### 3. Страница заказа УКЭП
**Файл:** `page-order-ukep.php`

**6 динамических секций товаров:**
1. Квалифицированные сертификаты (5 товаров)
2. Платные расширения для сертификатов (8 товаров)
3. Машиночитаемая доверенность (2 товара)
4. Криптопровайдеры (1 товар)
5. Носители ключей (Токен) (3 товара)
6. Дополнительные услуги (5 товаров)

**Особенности:**
- Контролы количества (+/-) для каждого товара
- Динамическая цена умножается на количество
- Радио-кнопки выбора типа плательщика (Юр. лицо / Физ. лицо / ИП)
- Кнопка "Оформить заказ" с AJAX отправкой

### 4. Страница заказа УНЭП
**Файл:** `page-order-unep.php`

**2 динамические секции:**
1. Усиленный неквалифицированный сертификат (3 товара)
2. Аутсорсинг услуг Удостоверяющего Центра (3 товара)

**Особенности:**
- Только чекбоксы, без контролов количества
- Каждый товар добавляется с quantity = 1
- Тот же функционал выбора типа плательщика

### 5. Страница заказа МЧД
**Файл:** `page-order-mchd.php`

**1 динамическая секция:**
1. Формат МЧД (2 товара: 003 и СФР)

**Особенности:**
- Только чекбоксы
- Простая структура с описаниями товаров

### 6. Импорт товаров WooCommerce
**Файл:** `woocommerce-CORRECT.csv`

- ✅ Создан CSV файл с 33 товарами
- ✅ Правильная категоризация (9 категорий)
- ✅ Использование русских названий категорий для авто-генерации slug

**Категории:**
- `kvalificzirovannye-sertifikaty` - 5 товаров
- `platnye-rasshireniya-dlya-sertifikatov` - 8 товаров
- `mashinochitaemaya-doverennost` - 2 товара
- `kriptoprovajdery` - 1 товар
- `nositeli-klyuchej-token` - 3 товара
- `dopolnitelnye-uslugi` - 5 товаров
- `usilennyj-nekvalificzirovannyj-sertifikat` - 3 товара
- `autsorsing-uslug-udostoveryayushhego-czentra` - 3 товара
- `format` - 2 товара

### 7. Исправление проблем

**Верстка:**
- ✅ Исправлена двойная обертка секций на УКЭП
- ✅ Корректное отображение контролов количества на мобильных
- ✅ Правильная структура HTML для всех элементов

**Функциональность:**
- ✅ Исправлен пересчет цены для страниц без контролов количества
- ✅ Исправлена синхронизация визуальных чекбоксов с реальными
- ✅ Устранены дублирующиеся обработчики событий

**Дизайн:**
- ✅ Изменены `<label>` на `<div>` для кнопок выбора типа плательщика
- ✅ Корректное отображение активного/неактивного состояния
- ✅ Читаемый текст на всех кнопках

## Технический стек

- **WordPress** + **WooCommerce** - CMS и e-commerce функционал
- **PHP 7.4+** - серверная логика
- **Tailwind CSS** - стилизация (CDN в HTML, классы в PHP)
- **jQuery** - клиентская логика
- **AJAX** - асинхронное добавление в корзину

## Структура файлов

```
enotarynew/
├── inc/
│   ├── product-helpers.php       # Функции работы с WooCommerce
│   ├── ajax-handler.php          # AJAX обработчики корзины
│   └── ...
├── assets/
│   ├── js/
│   │   └── universal-calc.js     # Универсальный калькулятор
│   ├── script.js                 # Общие JS функции
│   └── ...
├── page-order-ukep.php           # Шаблон страницы УКЭП
├── page-order-unep.php           # Шаблон страницы УНЭП
├── page-order-mchd.php           # Шаблон страницы МЧД
├── functions.php                 # Инициализация темы
├── woocommerce-CORRECT.csv       # Импорт товаров
└── _html-source/                 # Исходная HTML верстка (референс)
```

## Результат

Создана полностью функциональная система заказа с:
- ✅ Динамической загрузкой товаров из WooCommerce
- ✅ Автоматическим расчетом стоимости
- ✅ Корректной работой корзины
- ✅ 100% визуальным соответствием исходной верстке
- ✅ Адаптивным дизайном
- ✅ Чистым и поддерживаемым кодом

## Следующие шаги (TODO)

- [ ] Создание шаблонов форм:
  - `page-entrepreneur-form.php`
  - `page-individual-form.php`
  - `page-legal-entity-form.php`
  - `page-unep-legal-entity-form.php`
- [ ] Настройка процесса оформления заказа
- [ ] Интеграция с платежной системой
- [ ] Тестирование полного цикла заказа

---

**Дата последнего обновления:** 12 декабря 2025 г.
